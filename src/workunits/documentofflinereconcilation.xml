<workunit>
    <invokers>
        <invoker type="document_offlinereconciliation:create" caption="Offline Reconciliation" target="popup" action="init"/>
    </invokers>
    
    <code>
        <![CDATA[    
        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        import com.rameses.common.*;
        import java.rmi.server.*
        import com.rameses.util.*;
        
        class DocumentOfflineReconciliationController {
        
            @Caller
            def caller;
            
            @Binding 
            def binding;
            
            @Script("User")
            def user;
            
            @Service("TagabukidDTSService")
            def service;
            def mode = 'create'
            def handler;

            def reconciliationActions = ["outgoing", "send", "receive", "archive"];
            def entity = [:];
            
            void init() {
                mode = 'create'
                entity.din = caller?.entity.din;
                entity.title = caller?.entity.title;
                entity.author = caller?.entity.author;
                entity.description = caller?.entity.description;
                entity.documenttype = [name:caller?.entity.documenttype.name];
                entity.recordlog = [datecreated:caller?.entity.recordlog.datecreated,createdbyuser:caller?.entity.recordlog.createdbyuser];
                entity.prevtask = caller?.entity;
                entity.state = caller?.entity.state;
                entity.refid = caller?.entity.objid;
                entity.org = null;
            }
            
            def doOk() {
                if( mode == 'create' ) { 
                    service.createOfflineLog( entity );
                }
                if(handler) handler();
                return "_close";
            }
            
            def doCancel() {
                return "_close";
            }
            
        }
        
        ]]>
    </code>
    
    <pages>
        <page template="tagabukid.dts.view.DocumentOfflineReconciliation"/>
    </pages>
    
</workunit>