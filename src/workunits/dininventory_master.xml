<?xml version="1.0" encoding="UTF-8"?>
<workunit>
    <invokers>
        <invoker type="din:create" action="init" caption="DIN Inventory" target="window" />
        <invoker type="din:open" action="open" caption="DIN Invnetory" target="window" />
        <invoker type="extActions" caption="Print"  icon="images/toolbars/printer.png" visibleWhen="#{mode=='read'}"
            action="print"/>
    </invokers>
        
    <code lang="groovy">
        <![CDATA[ 
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;
        import java.text.DecimalFormat;
        
        public class DINInventoryController extends CRUDController
        {
            String serviceName = 'TagabukidDINInventoryService'
            String entityName  = 'din'
            String prefixId    = 'OC'
        
            def startseries;
            def endseries;
            boolean allowApprove = false;
            boolean allowEdit = false;
            boolean allowDelete = false;
        
            Map createEntity(){
                return [qty:0]
            }
            public void afterOpen(Object entity){
                entity.putAll(service.open(entity));
            }
        
            @PropertyChangeListener
            def listener = [
                'entity.qty':{
                    generateDIN();
                },
            ]   
        
            void generateDIN(){
                def dinsequence = service.getNextSequence(entity.qty);
                entity.startseries = dinsequence.startseries
                entity.endseries = dinsequence.endseries
                binding.refresh('entity.startseries,entity.endseries');
            }
            
            def print() {
                def op = Inv.lookupOpener( "dts:din", [entity: entity] );
                op.target = 'self';
                return op;
            }
        }
        ]]>
    </code>
    
    <pages>
        <page template="tagabukid.dts.master.DINInventoryPage" />
    </pages>
</workunit>
