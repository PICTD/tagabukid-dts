<workunit>
    <invokers>
        <invoker type="xdts:section" caption="Red Flags" index="-100" />
    </invokers>
    
    <code>
        <![CDATA[    
        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        import java.rmi.server.*
        import tagabukid.utils.*;
        
        class  DocumentGeneralInfoController  {
        
            @Binding
            def binding;

            @Service("TagbukidDTSService")
            def svc;
            
            String title = "General Info";
            String entityName = "dts:generalinfo";
            
            def entity;
            def attcachmentSelectedItem;
            
            def attachmentListHandler = [
                fetchList : { return entity.attachments },
            ] as BasicListModel
            
            void loadAttachments(){
                entity.attachments = [];
                try{
                    entity.attachments = TagabukidDBImageUtil.getInstance().getImages(entity?.objid);
                }
                catch(e){
                    println 'Load Attachment error ============';
                    e.printStackTrace();
                }
                attachmentListHandler?.load();
            }

            def viewAttachment(){
                if (!attachmentSelectedItem) return null;

                if (attachmentSelectedItem.extension.contains("pdf")){
                   return InvokerUtil.lookupOpener('attachmentpdf:view', [
                        entity : attachmentSelectedItem,
                    ]); 
                }else{
                    return InvokerUtil.lookupOpener('attachment:view', [
                        entity : attachmentSelectedItem,
                    ]); 
                }

            }
        }
        ]]>
    </code>

    
    <pages>
        <page  template="tagabukid.dts.view.DocumentGeneralInfo"/>
    </pages>
    
</workunit>