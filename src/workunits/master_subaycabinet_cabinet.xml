<workunit>
        
    <invokers>
        <invoker type="subaycabinet-cabinet:open" caption="Cabinet" action="open"/>
        <invoker type="subaycabinet-cabinet:create" caption="Cabinet" action="create"/>
    </invokers>
   
    <code>
    <![CDATA[
        import com.rameses.osiris2.common.*;
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import java.rmi.server.*;
          
        class TagabukidSubayCabinetGroupController extends CRUDController {
        
            @Caller
            def caller;
            
            @Service("TagabukidSubayTransactionService")
            def subaysvc
    
            String entityName = "subaycabinet";
            def node;
            boolean showConfirmOnSave = false;

            public String getServiceName() {
                return caller.getServiceName();
            }
            
            public String getTitle() {
                return caller.getTitle();
            }  
            
            public String getPrefixId() {
                return caller.getPrefixId();
            }
            
            public def getAccountService() {
                return caller.subaycabinetService;
            }

            Map createEntity() {
                def m = [parentid:node.objid, type:'cabinet'];
                m.parent = [code:node.code, title: node.title];
                m.orgid = subaysvc.getUserOrg(OsirisContext.env.USERID).org.objid
                caller.refresh();
                return m;
            }
            
            def transferParent() {
                return InvokerUtil.lookupOpener( "cabinet:lookup", [
                    onselect: { o->
                    
                        if (o.objid == entity.objid){
                            throw new Exception("Cannot Transfer " + entity.title  + " to " + entity.title);
                        }
                        else if(o.type == 'folder' && entity.type == 'cabinet'){
                             throw new Exception("Cannot Transfer a cabinet to a folder");
                        }
                        if( MsgBox.confirm('You are about to transfer this folder to another cabinet Continue?') ) {
                            service.changeParent( [parentid:o.objid, objid:entity.objid] );
                            entity.parentid = o.objid;
                            entity.parent = o;
                            caller.refresh();
                            binding.refresh();
                        }
                    }
                ]);
            }
            
        }      
       ]]>
   </code>
   
   <pages>
       <page template="tagabukid.subay.views.CabinetPage"/>
   </pages>
   
</workunit>